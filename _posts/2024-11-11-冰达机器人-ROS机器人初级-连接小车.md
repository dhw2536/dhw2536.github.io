---
layout:     post
title:      冰达机器人-ROS机器人初级-连接小车
subtitle:   涵盖了ROS机器人初级实践的各个方面，包括无线网络配置、底盘启动、键盘遥控、虚拟机和Ubuntu环境设置、ROS分布式通讯配置、机器人和PC时间同步、SSH免密登录、安卓手机终端app登录机器人、安卓ROS手机app遥控机器人运动，以及使用远程桌面连接机器人等关键步骤和技巧。
date:       2024-11-11
author:     Space
header-img: img/the-first.png
catalog:   true
tags:
    - 冰达机器人


---



# 冰达机器人 -ROS机器人初级-连接小车

## 3、ROS机器人初级-连接小车

### 1.1 nmcli命令配置机器人无线网

**1. 机器人有线网络连接**

- 打开机器人电源开关。
- 通过网线将机器人连接到路由器。
- 等待约1分钟，机器人开机。
- 通过路由器的DHCP列表查询机器人的IP地址。
- 示例IP地址：`192.168.31.145`。

![image-20241016211539918](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138480.png)

**2. 远程登录机器人**

- 使用Xshell通过SSH登录机器人。
- 输入机器人的IP地址进行连接。
- 输入机器人的用户名和密码（默认均为`bingda`）。
- 登录后，使用`ifconfig`命令查看网络状态。
- 确认有线网络接口`ETH0`的IP地址。

![image-20241016211629866](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138481.png)

![image-20241016211723086](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138482.png)

![image-20241016211808333](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138483.png)

**3. 无线网络配置**

- 使用`nmcli`工具配置无线网络。
- 需要管理员权限执行命令。
- 扫描周围的WiFi列表：`sudo nmcli device wifi list`。

![image-20241016211846481](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138484.png)

- 选择需要连接的WiFi热点（例如：TP-Link）。
- 执行连接命令：`sudo nmcli device wifi connect [WiFi名称]`。
- 输入WiFi密码，并使用`password`关键字。

![image-20241016211938721](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138485.png)

**4. 连接WiFi**

- 输入WiFi密码（例如：`ABCD1403`）。
- 执行命令后，等待约10秒，查看连接是否成功。
- 使用`ifconfig`命令确认无线网络接口`wlan`已获得IP地址。
- 示例无线IP地址：`192.168.31.110`。

**5. 保存无线网络连接**

- 使用新的无线IP地址重新建立Xshell连接。
- 建议勾选记住用户名和密码选项。

![image-20241016212351802](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138486.png)

**6. 固定IP地址**

- 为了避免IP地址频繁变化，可以在路由器中进行Mac地址和IP地址的绑定。

![image-20241016212331470](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138487.png)

- 进入路由器管理界面，找到IP与Mac绑定的设置。

![image-20241016212304025](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138488.png)

- 将机器人的Mac地址与IP地址（例如：`192.168.31.110`）进行绑定。

**7. 结课**

- 本节课介绍了如何使用命令行配置ROS小车的无线网络连接。

- 通过固定IP地址，确保了机器人网络连接的稳定性。

  

### 1.4 底盘启动和键盘遥控

**1. 远程登录工具设置**

- 使用Xshell进行远程登录。
- 确保PC和机器人连接在同一个路由器下（WiFi）或PC连接到机器人的热点（热点模式）。
- 使用机器人的IP地址进行登录。

![image-20241016212535166](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138489.png)

**2. 机器人启动**

- 使用ROS（Robot Operating System）启动机器人。
- 功能包：`flex_control`。
- 启动文件：`basic_control.launch`。

![image-20241016212622455](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138490.png)

**3. 机器人启动后信息**

- 机器人启动时会伴随一声长响。
- 输出底盘基础信息：
  - 硬件版本
  - 固件版本
  - 序列号
  - 设备类型
  - 电机类型
  - 减速比轮径等信息。

**4. 检查话题列表**

- 新建终端连接到机器人。
- 检查话题列表，如电池信息（`Battery`话题），订阅速度话题（`CMDV`）等。
- 电池话题频率为1Hz，即每秒发布一次。

![image-20241016212713837](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138491.png)

**5. 键盘遥控操作**

- 新建终端启动键盘遥控程序。
- 使用ROS功能包`teleop_twist_keyboard`实现键盘遥控。

![image-20241016212935230](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138492.png)

- 键位对应关系：
  - `i`键：向前
  - `k`键：停止
  - `,`键：后退
  - 大写字母键：实现横向运动（全向移动车型）
- 控制时需确保鼠标点击终端框内，以确保输入有效。

**6. 话题检查与控制**

- `CMDV`话题现在有发布者（键盘遥控程序）和订阅者（机器人）。
- `ODOM`话题暂无定位值，因为没有节点使用该信息。

**7. 速度控制**

- 使用`Q`和`Z`键调整速度，每次增减10%。
- 使用`W`、`X`、`E`、`Z`键单独控制线速度或角速度。

**8. 参数配置**

- `best_control`功能包的`launch`文件下有可配置参数。
- 例如，通过传入参数`pub_imu:=true`来输出IMU原始数据。

**9. IMU数据输出**

- 设置参数后，底盘启动时会输出IMU话题。
- 输出内容包括：
  - 传感器原始信息
  - 结算后的四元数
  - 原始的角速度信息
  - 线加速度信息

**10. 结课**

- 本节课介绍了机器人的启动、键盘遥控程序操作以及话题的梳理。
- 后续课程将深入解读`best_control.launch`文件。



### 1.5.1 虚拟机和ubuntu的使用

[1-1-5.虚拟机和ubuntu的使用_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1X64y1S7fd?spm_id_from=333.788.player.switch&vd_source=e03b252a2c1fefc80e6f48a6f52e2a4d&p=3)

跟着这个教程安装即可

如果你不使用我们提供的虚拟机环境，而是使用自己的Ubuntu环境，需要进行以下准备工作：

1. **下载软件**：从资料包中下载搭建PC端Ubuntu环境所需的软件。

![image-20241016213251104](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138493.png)



### 1.5.2 使用自己搭建的ubuntu环境

**课程简介**

本节课将介绍如何在不使用提供的虚拟机环境的情况下，使用自己的Ubuntu环境进行ROS小车操作的准备工作。

**准备工作**

1. **下载软件**：从资料包中下载搭建PC端Ubuntu环境所需的软件。
2. **拉取功能包**：从远程仓库拉取我们提供的一些ROS功能包。

![image-20241016213518613](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138494.png)

**操作步骤**

1. **跳转工作空间**：

   - 以`catkin_ws`工作空间为例，跳转到工作空间的`src`目录下。

   ![image-20241016213539685](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138495.png)

2. **拉取功能包**：

   - 复制并执行拉取功能包的指令。

   ![image-20241016213610668](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138496.png)

   - 如果已经下载，可以先删除对应的文件夹，例如`CTRL`文件夹。
   - 使用国内的镜像地址拉取，以加快下载速度。
   - 依次拉取我们提供的5个功能包。

   ![image-20241016213619124](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138497.png)

3. **编译工作空间**：

   - 使用`catkin_make`命令编译工作空间。
   - 确保编译过程中没有出现问题。

   ![image-20241016213652437](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138498.png)

4. **解决依赖**：

   - 由于我们提供的ROS功能包可能依赖于第三方功能包，需要解决这些依赖。
   - 使用`rosdep`检查依赖项是否满足。

   ![image-20241016213731170](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138499.png)

   - 如果`rosdep`可以正常使用，可以通过它来检查依赖项。
   - 如果某个依赖项缺失，可以根据提示手动安装，或者使用`rosdep install`命令自动安装缺失的依赖项。

   ![image-20241016213825424](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138500.png)

5. **检查依赖状态**：

   - 再次使用`rosdep check`命令检查所有依赖是否已经满足。

6. **手动安装**：

   - 如果`rosdep`无法正常使用，可以根据提供的软件清单，通过`apt`命令手动安装所需的软件包。
   - 首先执行`apt update`更新软件源，然后安装软件列表中的软件包。



### 1.6 ROS分布式通讯配置

本节课将介绍如何在ROS中配置分布式通讯。

**远程登录与网络配置**

1. **打开远程登录工具**：登录到机器人端。

2. **打开虚拟机**：确保虚拟机已启动。

3. 检查网络配置：

   - 点击虚拟机左上角的“Player”可移动设备网络适配器设置。
   - 确保网络模式为桥接模式，其他模式不可用。

   ![image-20241016214252208](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138501.png)

   - 选择正确的网络适配器，确保与路由器连接的网卡一致。

   ![image-20241016214310807](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138502.png)

   - 如果笔记本通过无线连接到路由器，机器人也通过无线连接，选择无线网卡。
   - 如果笔记本通过有线网络连接，机器人通过无线连接，选择有线网卡。
   - 如果使用机器人的AP模式，PC通过无线连接到机器人AP，选择无线网卡。

**网络适配器设置**

- 选择完毕后，建议重启虚拟机以应用设置。
- 检查虚拟机网络状况，确保虚拟机和机器人端的IP在同一网段。

![image-20241016214418207](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138503.png)

**网络测试**

1. 互相ping测试：

   - 从机器人端ping虚拟机的IP（例如：192.168.31.117）。

   ![image-20241016214442234](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138504.png)

   - 从虚拟机端ping机器人端的IP（例如：192.168.31.105）。

   ![image-20241016214642031](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138505.png)

   - 确保两者可以互相ping通，显示延迟。

**分布式通讯配置**

1. **修改配置文件**：

   - 在PC端修改配置文件，可以使用图形化编辑工具。

   ![image-20241016215002306](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138506.png)

   - 找到`ROS_MASTER_URI`这一行，将IP改为机器人端实际获取的IP（例如：192.168.31.105），端口号（例如：11311）保持不变。
   - 如果机器人运行在AP模式下，修改为`192.168.9.1`。

   ![image-20241016215342427](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138507.png)

   - 如果在WiFi模式下，修改为机器人实际获取的IP地址。

2. **保存并重新加载配置**：

   - 保存修改并关闭配置文件。
   - 在终端执行`roscore`重新加载配置文件，或重启终端。

   ![image-20241016215555470](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138508.png)

**测试分布式通讯**

1. **在机器人端启动ROS节点**。
2. 在PC端查看话题列表：确认PC端可以看到机器人端发布的话题。
   - 启动机器人底盘节点，然后在虚拟机中使用`rostopic list`检查话题列表。

**结束语**

在配置分布式通讯之前，务必先检查网络连接的前提条件。如果网络互相ping不通，配置分布式通讯将无意义。



### 1.7 机器人和PC时间同步

**课程简介**

本节课将介绍如何在没有外部网络的情况下，实现机器人和PC的时间同步。

**时间同步的重要性**

- 大部分电子设备通过NTP服务器自动校对时间，以保证时间戳的一致性。
- 在没有互联网的局域网环境下，或使用机器人本身的AP模式时，机器人无法通过NTP服务器校对时间。
- 某些设备如树莓派没有RTC模块，无法保持时间。

**时间不同步的后果**

- 时间偏差可能导致分布式通讯出现问题。
- 例如，机器人端和PC端时间戳不同步，可能导致图像处理应用无法正常获取图像。

![image-20241016220618511](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138509.png)

**时间同步操作步骤**

1. **检查时间差异**：

   - 登录到机器人，查看当前时间。
   - 打开虚拟机，运行`date`命令查看时间。
   - 比较两者时间，确认时间差异。

2. **安装NTP服务器**：

   - 如果PC也没有外网环境，先获取外网环境。
   - 在PC上安装NTP服务器：`sudo apt install ntp`。

   ![image-20241016220700666](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138510.png)

3. **配置机器人时间同步**：

   - 在机器人端，使用`ntpdate`命令同步PC时间：`ntpdate <PC_IP>`。
   - 使用`ifconfig`查看PC端的IP地址，例如：`192.168.9.179`。

   ![image-20241016220823727](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138511.png)

4. **验证时间同步**：

   - 在机器人上再次运行`date`命令，确认时间已同步。
   - 确保机器人和PC的时间基本一致。

   ![image-20241016220845165](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138512.png)

   ![image-20241016220934213](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138513.png)

   ![image-20241016220913367](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138514.png)

5. **定期校准时间**：

   - 如果机器人没有外网环境，每次开机后都需要通过`ntp date`命令校准时间。

**测试分布式通讯**

- 运行之前无法正常工作的DEMO，验证时间同步后是否能够正常显示图像。

**结束语**

时间同步对于分布式通讯非常重要，尤其是在没有外部网络的环境中。每次开机后都需要确保机器人和PC的时间同步，以避免因时间戳不同步导致的问题。希望本节课能帮助大家理解和掌握时间同步的操作方法。



### 1.8 ubuntu下ssh免密登录

本节课将介绍在Ubuntu环境下如何通过SSH进行远程登录以及如何设置免密登录。

**SSH登录**

1. **确保在同一局域网**：

   - 机器人和PC需要在同一局域网下，可以通过ping命令测试连通性。

2. **打开终端**：

   - 在Ubuntu环境下，直接使用终端进行远程登录。

   ![image-20241016221216582](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138515.png)

3. **输入SSH命令**：

   - 使用`ssh`命令后跟用户名和IP地址登录机器人，例如：`ssh bingda@192.168.9.1`。

4. **输入密码**：

   - 输入机器人端的密码（例如：`bingda`的拼音）。

**验证连接**

- 使用`ifconfig`命令验证网络连接的IP地址，确保PC和机器人在同一网段。

**区分终端**

- 注意区分PC终端和机器人终端，机器人终端后缀为`@robot`。

![image-20241016221342756](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138516.png)

**免密登录设置**

1. **生成SSH密钥**：

   - 在PC终端中生成SSH密钥对，使用命令：`ssh-keygen`。

   ![image-20241016221512172](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138517.png)

2. **拷贝公钥到机器人**：

   - 将生成的公钥拷贝到机器人端，使用命令：`ssh-copy-id 宾达@192.168.9.1`。

   ![image-20241016221525643](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138518.png)

3. **输入机器人密码**：

   - 在拷贝公钥时输入机器人端的密码。

4. **测试免密登录**：

   - 退出当前会话，重新使用`ssh`命令登录机器人，此时不应要求输入密码。

**注意事项**

- 确保使用的IP地址是机器人实际获取的IP地址。
- 在后续课程中，为了区分指令输入的终端，可能仍然使用X shell登录机器人。
- 注意设备名后缀的区别，确保指令在正确的终端中输入。

**结束语**

通过SSH进行远程登录和设置免密登录可以方便地在Ubuntu环境下管理机器人。本节课介绍了SSH登录和免密登录的设置步骤，希望大家能够掌握这些操作。在实际操作中，注意区分PC终端和机器人终端，以避免混淆和错误。



### 1.9 安卓手机终端app登录机器人

本节课将介绍如何使用手机远程登录到机器人上。

**网络配置**

1. 确保手机和机器人在同一局域网：

   - 如果机器人使用WiFi模式，将手机和机器人连接到同一个路由器热点。
   - 如果机器人使用AP模式，将手机WiFi连接到机器人的AP热点。

   ![image-20241016225259349](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138519.png)

**连接步骤**

1. **连接热点**：

   - 点击连接机器人的AP热点。
   - 输入密码（例如：12345678）完成连接。

2. **打开手机终端应用**：

   - 打开手机上的终端应用。
   - 如果提示没有互联网连接，选择继续使用。

   ![image-20241016225342213](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138520.png)

3. **配置远程登录**：

   - 在终端应用中，点击右下角的笔形图标进行设置。
   - 在主机栏输入机器人的IP地址（例如：192.168.9.1）。
   - 如果机器人使用WiFi模式，需要根据机器人的实际IP地址替换。
   - 确认端口设置为22，选择密码登录方式。

   ![image-20241016225442928](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138521.png)

4. **开始远程登录**：

   - 点击开始进行远程登录。
   - 确认登录成功，进入机器人的命令行界面。

**使用手机终端操作**

1. **使用Tab键补全**：

   - 在全屏状态下，下拉终端界面，找到FN键。
   - 使用箭头加竖线符号的Tab键进行命令补全。

2. **调整字体大小**：

   - 根据需要调整终端字体大小，以便一屏显示所有内容。

3. **启动机器人应用**：

   - 在终端中输入命令启动机器人应用（例如：`rosrun`）。
   - 使用Tab键自动补全命令。

4. **测试机器人功能**：

   - 通过手机终端测试机器人的功能（例如：启动键盘遥控节点）。

5. **结束操作**：

   - 使用CTRL+C结束当前运行的程序。
   - 退出终端应用。

   ![image-20241016225602886](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138522.png)

**结束语**

通过手机终端远程登录到机器人上，可以在没有电脑的情况下进行操作，非常适合演示环境。本节课介绍了如何配置和使用手机终端进行远程登录，希望大家能够掌握这一技能。



### 1.10 安卓ROS手机app遥控机器人运动

本节课将介绍如何使用手机APP `roses control` 来遥控机器人的操作。

**软件设置**

1. **打开软件**：启动 `roses control` 应用。

![image-20241016225633888](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138523.png)

1. **权限授权**：首次启动时，授权所需权限，选择“始终允许”。

2. 创建机器人连接

   - 在启动引导页面，点击右上角的加号创建机器人连接。
   - 输入机器人的名称和实际IP地址（例如：`192.168.31.91`），端口保持默认的`11311`。

   ![image-20241016225732425](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138524.png)

**启动机器人应用**

1. 远程登录机器人：

   - 使用手机终端登录到机器人。
   - 输入命令启动机器人的底盘应用。

   ![image-20241016225822608](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138525.png)

**连接测试**

- 启动机器人应用后，`roses control` APP中的WiFi图标应由灰色变为黑色，表示可以连接。

**控制操作**

1. **进入控制界面**：

   - 点击变为黑色的WiFi图标进入控制界面。
   - 使用右下角的摇杆控制机器人运动。

2. **编辑话题名**：

   - 如果控制无反应，点击笔形符号编辑设置。
   - 确认速度话题名（如：`CMD_VL`）正确。
   - 修改里程计话题名（如：将`odom_filter`改为`ODOM`）。

   ![image-20241016225922614](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138527.png)

3. **查看速度信息**：

   - 编辑后，左上角的速度表应显示机器人的线速度和角速度。

4. **其他控制模式**：

   - 使用手势控制：通过手机陀螺仪控制机器人，如手机前仰使摇杆向前拉，机器人前进。

5. **高级设置**：

   - 编辑话题名，调整警告系统。
   - 根据操作习惯，可以反转X轴和Y轴。

   ![image-20241016225945753](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138528.png)

**结束语**

通过 `roses control` 手机APP，我们可以方便地遥控机器人，无论是在演示环境还是日常操作中都非常实用。本节课介绍了如何设置和使用APP进行遥控操作，希望大家能够掌握这一技能。



### 1.11 使用远程桌面连接机器人

本节课将介绍如何使用远程桌面软件连接到机器人。

**软件安装**

1. 下载并安装远程桌面软件：
   - 从提供的资料包中的“Windows相关使用软件”文件夹下找到远程桌面软件。
   - 在PC上双击安装程序并完成安装。

**连接设置**

1. **确保机器人和PC在同一局域网**：

   - 确保机器人和PC连接到同一个路由器或热点。

   ![image-20241016230145452](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138529.png)

2. **输入机器人IP地址**：

   - 打开远程桌面软件，输入机器人的IP地址（例如：`192.168.31.129`）。

3. **连接到机器人**：

   - 点击“连接新的host”开始连接。

**登录操作**

1. **输入用户名和密码**：

   - 输入用户名（通常是`bingda`）和密码（通常是`bingda`）。

   ![image-20241016230204261](https://raw.githubusercontent.com/dhw2536/Picture/main/202411111138530.png)

   - 如果长期使用，可以选择保存用户名和密码。

2. **登录机器人桌面**：

   - 点击登录进入机器人的桌面环境。

3. **软件版本选择**：

   - 选择不升级，以保证软件版本一致性，避免兼容性问题。

**验证连接**

- 使用`ifconfig`命令验证网络连接的IP地址。

**远程桌面应用**

1. **图形化界面**：
   - 通过远程桌面为没有搭载屏幕的机器人提供图形化界面。
   - 便于进行操作，如使用图形化界面的编辑器。
2. **图形化调试工具**：
   - 运行需要图形化界面的调试工具，如摄像头图像显示。
3. **分布式通信配置**：
   - 配置分布式通信，使机器人的图像能在PC端显示。
4. **执行指令**：
   - 在机器人的远程桌面上执行需要在PC端执行的指令。

**结束操作**

- 使用完毕后，直接关闭远程桌面软件，自动断开连接。

**结束语**

远程桌面为没有屏幕的机器人提供了一个方便的图形化操作界面，使得操作更加直观和便捷。本节课介绍了如何使用远程桌面软件连接和操作机器人，希望大家能够掌握这一技能。
