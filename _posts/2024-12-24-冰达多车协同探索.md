---
layout:     post
title:      冰达多车协同探索
subtitle:   xxx
date:       2024-12-18
author:     Space
header-img: img/the-first.png
catalog:   true
tags:
    - 本科毕设探索

---





# 冰达多车协同探索



## **1. 获取并配置三台机器人**

- 将编号为0、1、2的三台机器人小车取到手中，确保每辆车都能正常使用网络连接。
- 确定并记录每辆车的IP地址，以方便后续设置和通信。
- **任务细化：**
  - 检查每辆车的硬件状态，确保电池、电机、传感器等组件正常工作。
  - 更新每辆车的系统和相关软件包，确保版本一致性。

每辆机器人与TP-link路由器通信的无限IP如下：

![image-20241224165420368](https://raw.githubusercontent.com/dhw2536/Picture/main/202501232212183.png)



## **2.领航者和跟随者的角色设定**

- 将编号为0的小车设置为**领航者**，编号为1和2的小车设置为**跟随者**。
- **任务细化：**
  - 在领航者和跟随者上统一ROS版本和环境配置。
  - 确保领航者能够发布运动指令，跟随者能够订阅并执行。

#### **配置多机器人系统网络** 

**前提条件：**
所有机器人都连接在同一个路由器下，如有使用到PC，PC也需要连接在同一路由器下，所有设备互相可以ping通。

在实验中，我们将robot_0配置为Master，其余所有设备都使用这个Master节点。

**robot_0：**

由于机器人出厂时默认使用本机IP作为Master地址，所以robot_0不需要做修改，查找并记录下机器人的IP地址即可，例如我当前使用的robot_0的IP地址为192.168.1.102

**其他设备：**

需要修改`～/.bashrc`文件来配置Master节点IP，可以通过gedit编辑器修改文件

```bash
gedit ~/.bashrc
```

只需要在文件末尾增加如下行，其中192.168.10.102为robot_0的地址，根据实际获得的IP正确填写

```
export ROS_MASTER_URI=http://192.168.10.102:11311/
```

修改完成后保存文件，关闭编辑器，并关闭所有打开的终端。

#### **多机器人系统网络连通性测试** 

在**robot_0**中启动roscore

```bash
roscore
```

在其余设备中检查话题列表，话题列表中应该有`/rosout`和`/rosout_agg`两个话题

```bash
rostopic list
```

如出现`ERROR: Unable to communicate with master!`请关闭终端重新打开，如问题依然存在，请检查上一步骤中的配置。

![image-20241224170812389](https://raw.githubusercontent.com/dhw2536/Picture/main/202501232212184.png)



## **3. 多机器人控制（分别控制）**

#### 1. 启动机器人底盘节点
- **robot_0**:
  ```bash
  roslaunch base_control base_control.launch robot_name:=robot_0
  ```
- **robot_1**:
  ```bash
  roslaunch base_control base_control.launch robot_name:=robot_1
  ```
- **robot_2**:
  ```bash
  roslaunch base_control base_control.launch robot_name:=robot_2
  ```
  - 注意：必须先在`robot_0`上启动Master节点，否则其他设备启动节点会出现错误。

#### 2. 启动键盘控制节点
- **控制`robot_0`**:
  
  ```bash
  rosrun teleop_twist_keyboard teleop_twist_keyboard.py __ns:=robot_0
  ```
- **控制`robot_1`**:
  ```bash
  rosrun teleop_twist_keyboard teleop_twist_keyboard.py __ns:=robot_1
  ```
- **控制`robot_2`**:
  ```bash
  rosrun teleop_twist_keyboard teleop_twist_keyboard.py __ns:=robot_2
  ```
  - 现在可以通过三个终端使用键盘控制机器人运动。

#### 3. 机器人的命名空间
- 通过`rqt_graph`查看节点和话题名，可以看到所有节点和话题名称前都加上了`/robot_0`、`/robot_1`或`/robot_2`。
- 命名空间机制：在启动机器人底盘节点和键盘控制节点时传入的`robot_0`、`robot_1`和`robot_2`给相关的节点和话题添加了前缀，这样可以避免多个机器人同时工作在一个ROS网络下会出现节点和话题重名的问题，命名空间是实现ROS多机器人系统的关键。

**注意：**rqt_graph需要配置左上角显示内容，否则无法显示

![image-20241224171929351](https://raw.githubusercontent.com/dhw2536/Picture/main/202501232212185.png)

#### 4. 命名空间的更多信息
- 更多关于命名空间的内容可以参考官方Wiki：
  [Names - ROS Wiki](http://wiki.ros.org/Names)



## **4.多机器人同步控制**

#### 1. 启动机器人底盘控制节点
- **robot_0**:
  
  ```bash
  roslaunch base_control base_control.launch robot_name:=robot_0
  ```
- **robot_1**:
  
  ```bash
  roslaunch base_control base_control.launch robot_name:=robot_1
  ```
- **robot_2**:
  ```bash
  roslaunch base_control base_control.launch robot_name:=robot_2
  ```

#### 2. 启动键盘控制节点
- 在任意一台设备上启动键盘控制节点：
  ```bash
  rosrun teleop_twist_keyboard teleop_twist_keyboard.py
  ```

#### 3. 启动cmd_vel 转发节点
- 在任意一台设备上启动cmd_vel 转发节点，指定控制机器人数量为 3：
  ```bash
  rosrun multi_robot cmd_vel_boardcast.py _robot_num:=3
  ```
  - 这个节点将订阅`/cmd_vel`话题，并将接收到的命令加上各个机器人的命名空间后分别发布出去，实现对多台机器人的同步控制。

#### 4. 同步控制效果
- 现在可以在键盘控制节点的终端中通过按键对所有机器人同步进行控制，即所有机器人一起前进或旋转。

#### 5. 查看节点和话题名
- 启动`rqt_graph`来查看当前的节点和话题名：
  - 与之前的图像相比，可以看到`/robot_0/cmd_vel`、`/robot_1/cmd_vel`和`/robot_2/cmd_vel`是由`/cmd_vel_boardcast`节点订阅`/cmd_vel`而发布出来的，而不是由`/robot_0/teleop_twist_keyboard`、`/robot_1/teleop_twist_keyboard`和`/robot_2/teleop_twist_keyboard`各自独立发布出来。

通过这种方式，可以实现通过一个键盘控制节点对多个机器人（包括`robot_0`、`robot_1`和`robot_2`）的同步控制。

![image-20241224173045684](https://raw.githubusercontent.com/dhw2536/Picture/main/202501232212186.png)



## **5.激光SLAM建图**

#### Step 1: 启动机器人SLAM建图
- 打开终端，输入启动机器人SLAM的命令。

```
roslaunch robot_navigation robot_slam_laser.launch
```

- 确认终端中无红色报错信息，且持续有SLAM的信息输出，表示工作正常。

#### Step 2: 启动可视化图形界面
- 打开终端，输入启动机器人SLAM的命令。
- 执行命令后，会弹出可视化地图的窗口。
  - 灰色区域：已构建的地图
  - 黑色：地图边界
  - 红色：激光雷达扫描的数据
- 地图显示区域内操作：
  - 滚动鼠标滚轮：缩放地图
  - 按住鼠标滚轮移动鼠标：移动显示区域
  - 调整地图显示到合适的位置。

#### Step 3: 控制机器人在需要建图的区域移动
- **方法1**：使用机器人配备的PS2遥控手柄。
- **方法2**：使用键盘控制节点。
  - 新打开一个终端，输入以下命令：
    ```bash
    rosrun teleop_twist_keyboard teleop_twist_keyboard.py
    ```
  - SLAM建图中，机器人运动速度不宜过快，建议调整键盘控制速度：
    - 线速度不大于0.3m/s
    - 角速度不大于0.7rad/s

#### Step 4: 保存地图
- 当机器人构建完所需区域的地图后，可以保存地图，用于后续的导航实验。
- 新打开一个终端，先输入切换目录的命令，再执行保存地图命令：
  ```bash
  roscd robot_navigation/maps/ && rosrun map_server map_saver -f map
  ```
- 终端中提示“Done”即为保存成功。

#### 注意事项
- 在实验结束后关闭所有节点。
- 搭载C1雷达启动SLAM建图的命令如下（非此配置跳过看下一章节）：
  1. 启动单雷达：
     ```bash
     roslaunch robot_navigation robot_lidar.launch
     ```
  2. 启动SLAM建图：
     ```bash
     roslaunch robot_navigation gmapping.launch
     ```
  3. 打开rviz图像显示：
     ```bash
     roslaunch robot_navigation slam_rviz.launch
     ```
  4. 键盘控制小车移动：
     ```bash
     rosrun teleop_twist_keyboard teleop_twist_keyboard.py
     ```
  5. 保存地图：
     ```bash
     roscd robot_navigation/maps/ && rosrun map_server map_saver -f map
     ```







1. **创建跟随者的Launch文件**

   - 在每个跟随者的小车上建立专属的`launch`文件，用于将从领航者（`/robot0/cmd_vel`话题）接收到的速度指令，直接转发到自身（`/robot1/cmd_vel`或`/robot2/cmd_vel`话题）。
   - **任务细化：**
     - 学习如何编写和使用ROS的`launch`文件，理解其中的节点和参数配置。
     - 使用`topic_tools`的`relay`或自定义节点实现话题转发功能。

2. **网络配置与IP修改**

   - 根据网上的多机编队教程，修改跟随者的主机IP，使其与领航者处于同一网络下。
   - 注意在修改IP后，需要保存配置并重启网络服务或设备，以确保生效。
   - **任务细化：**
     - 备份原始网络配置文件，以防止配置错误导致通信中断。
     - 测试各机器人之间的连通性，确保能够正常Ping通。

3. **启动底盘程序**

   - 按照冰达的相关教程，在领航者（robot0）和跟随者（robot1、robot2）上分别启动底盘程序。
   - 确保在启动前，代码中的机器人编号参数已正确设置为对应的robot0、robot1等，避免冲突。
   - **任务细化：**
     - 检查启动日志，确保各项节点和服务正常运行，没有报错。
     - 验证底盘的基本运动功能，如前进、后退、旋转等指令是否有效。

4. **运行跟随者的Launch文件**

   - 在每个跟随者上，运行之前建立的`launch`文件，使其能够接收并执行领航者的运动指令。
   - **任务细化：**
     - 监控跟随者的运行状态，观察是否成功响应领航者的指令。
     - 调整必要的参数，如话题名称、队列长度、频率等，以优化通信效果。

5. **使用MATLAB验证编队效果**

   - 在MATLAB上连接领航者的IP地址，运行`cs`代码，检查跟随者是否能够与领航者保持同步编队运动。
   - **任务细化：**
     - 学习MATLAB与ROS的通信方法，确保数据能够实时传输。

6. **尝试集成不同厂商的机器人**

   - 尝试将轮趣的机器人小车按相同的方法加入编队，如果成功，则实现了异构机器人之间的多车编队。
   - **任务细化：**
     - 研究轮趣小车的通信协议和控制方式，找到与现有体系兼容的方法。
     - 解决可能出现的接口和兼容性问题，确保不同机器人能协同工作。

7. **探索SLAM建图与导航**

   - 继续研究并实践SLAM（同步定位与建图）相关的操作，实现机器人在未知环境下的自主导航。
   - **任务细化：**
     
     - 学习主流的SLAM算法，如Gmapping、Cartographer、RTAB-Map等。
     - 结合传感器数据（如激光雷达、深度相机），构建环境地图并规划路径。
     
     

## 二、之后发展方向

1. **大模型控制**

   - 引入先进的机器学习模型（如Transformer、GPT等）来提升机器人控制的智能化水平。
   - **任务细化：**
     - 研究大模型在机器人感知、决策和控制中的应用潜力。
     - 尝试将预训练模型部署在机器人系统中，优化资源占用和响应速度。

2. **深度强化学习用于多机器人路径规划**

   - 利用深度强化学习算法，为多机器人系统设计高效的路径规划和协同策略。

   - **任务细化：**
     - 搭建仿真环境（如Gazebo）来训练和测试强化学习算法。
     
     - 探索多智能体强化学习的方法，解决机器人间的协同与竞争问题。
     
       

## **可能解决方案**

								1. 单车深度强化学习路径规划、其他车辆跟随领航者（往单车部署深度强化学习算法、可以参考新加坡黄博士的项目）
								1. 探索多智能体、多机器人路径规划的论文（用深度强化学习、周五可以过一下、找SRTP的同学来读文献写研究现状部分）
								1. 





1. **与王力老师沟通，探讨研究方向**

   - 与王力老师进行交流，制定后续的研究计划。

   

- **教学资源**

  - 由于自学探索多机器人深度强化学习存在一定难度，小红书上《Gazebo仿真多机器人深度强化学习教学》的辅导（价格2500元）。
    - 或者寻找免费或更实惠的学习资源，如开源项目、在线课程、学术论文等。
    - 或者老师在清华那边的课题组有没有相关师兄在做这个方向，可以交流学习。
- **团队协作**
  - **利用SRTP同学的力量**
    - 安排SRTP的同学们每周研究一个开源项目，并在每周的组会上进行分享。
    - 鼓励他们每周阅读2-3篇相关论文，加深对领域前沿的理解，也配合我的研究现状部分内容。
    - **好处：**
      - 增强团队的整体科研能力，加快项目进展。
      - 培养同学们的科研兴趣和能力，为后续研究储备人才。

- **项目目标**
  - 短期内完成多机器人编队的基本功能，实现实际小车的同步运动和简单的导航任务。
  - 长期目标是探索基于深度学习和强化学习的多机器人协同控制，为机器人群体智能研究做出贡献。
  
- **挑战与解决方案**

  - **挑战：**
    - 技术难度高，自学成本大。
    - 资源有限，缺乏高质量的教学和指导。
  - **解决方案：**
    - 积极寻求导师和同学的支持，形成学习共同体。
    - 合理利用网络资源，参加线上线下的研讨和培训。

- **期待**

  - 希望老师能够提供相关的指导和支持，特别是在深度强化学习和多机器人协同方面。
  - 期待通过团队的共同努力，克服困难，取得有意义的研究成果。

- 开源项目：
  - ROS多机器人编队示例
  - OpenAI的多智能体强化学习环境
- 学术论文：
  - 多机器人系统的协同控制综述
  - 深度强化学习在机器人领域的最新进展
- 在线课程和教学视频：
  - Coursera、edX等平台的机器人学课程
  - Bilibili上的机器人相关教学视频
  
  **资源推荐**：
  
  - **论文**：
    - *Multi-Agent Reinforcement Learning: A Survey*（多智能体强化学习综述）
  
    - *Cooperative Multi-Agent Control Using Deep Reinforcement Learning*（使用深度强化学习的多智能体协同控制）
  
  - **开源项目**：
  
    - GitHub上的MARL框架，如 [MADDPG](https://github.com/openai/maddpg)、[RLLib](https://github.com/ray-project/ray/tree/master/rllib)
  
  - **书籍**：
    - 《强化学习：原理与实践》（Richard S. Sutton等著）



## 三、确定最后任务场景

在仓储物流场景中，三辆机器人从不同的位置出发，前往同一目标点（货物所在地），到达后进行编队，然后进行协同路径规划。

**这一部分我还需要再确认一下**

- **是否需要提前编队**：三辆机器人可以从不同位置出发，然后在目标点附近集合，形成指定的编队形状（如“△”型、“一”型）。这更符合实际仓储场景中的需求，也增加了路径规划的复杂性和挑战性。

- **任务场景的细化**：

  1. **机器人初始位置和目标位置的设置**：明确机器人的初始位置、目标位置，以及环境中的障碍物分布。

  2. **编队形状的选择和意义**：不同的编队形状可能适用于不同的任务，例如：“△”型适合包围目标，“一”型适合通过狭窄通道。

  3. **协同路径规划的目标**：机器人在编队后需要完成的任务，例如共同搬运货物、同步移动等。





## 四、毕业设计大纲内容

**编队作业场景下 集群机器人 协同路径规划 研究**

#### 1. 课题背景及研究意义

**1.1 研究背景**

- **政策、市场背景**：介绍国家对智能物流、仓储自动化的支持政策，以及市场对多机器人协同工作的需求。

- **多机器人编队介绍**：阐述多机器人编队的概念、优势，以及在物流领域的应用价值。

- **现存问题**：指出当前多机器人系统在路径规划、协同控制方面面临的挑战，例如路径冲突、通信延迟、环境不确定性等。

- **技术介绍**：介绍具体技术（目前尚未确定），比如可以介绍强化学习在机器人控制中的潜力，以及其在解决复杂决策问题中的优势。

**1.2 国内外研究现状**

- **多机器人系统现状**：总结国内外多机器人系统的发展，重点关注编队控制和协同路径规划的研究进展。

- **相关路径规划技术或编队方法**：介绍传统的路径规划算法（如A* 、Dijkstra、D*）和编队方法，以及它们的优缺点。

- **强化学习在多机器人系统中的应用**：（这部分如果不用强化学习，还需要再换）可以先查阅一些相关研究，初步了解强化学习在多机器人路径规划中的应用现状。

**1.3 研究意义和创新点**

- 阐述本研究在理论和实践方面的意义，例如提高物流效率、降低成本等。

- 强调创新点，如使用强化学习解决多机器人协同路径规划问题，或者提出新的编队策略。

**1.4 研究内容**

- 对后续章节的内容进行概述，说明研究的主要环节和方法。

#### 2. 多机器人集群微缩平台

**2.1 系统组成与配置**

- 详细介绍机器人硬件平台、传感器、通信模块等。

- 描述系统架构，包括机器人端和上位机端的软件设计。

**2.2 系统功能与模块**

- **通信模块**：机器人之间以及机器人与控制中心的通信方式。

- **编队控制模块**：实现机器人编队的算法和策略。

- **建图模块**：环境感知和地图构建的方法。

- **导航模块**：路径规划和运动控制的实现。

#### 3. 实验场景搭建

**3.1 仿真**

- 使用Gazebo搭建仓储环境的仿真模型，包含货架、通道、障碍物等元素。

**3.2 实车实体沙盘**

- 制作仓储环境的实体沙盘，用于实物测试。

- 设计不同的测试场景，模拟实际应用中的各种情况。



#### 4. 集群机器人协同路径规划算法

**4.1 传统算法分析**

- 介绍传统的多机器人路径规划算法，如集中式算法、分布式算法、优先级规划等。

- 分析这些算法的优缺点，以及在复杂环境中的适用性。

**4.2 强化学习基础与框架**

- 介绍强化学习的基本概念和算法，如Q学习、深度Q网络（DQN）、策略梯度等。

- 讨论多智能体强化学习（Multi-Agent Reinforcement Learning, MARL）的原理和挑战。

**4.3 强化学习路径规划设计**

- 设计基于强化学习的多机器人协同路径规划算法。

- 确定状态空间、动作空间、奖励函数等关键要素。

- 讨论训练方法和框架选型，例如集中式训练、分布式训练等。

**4.2和4.3还不能确定，目前不清楚能否用强化学习做多车路径规划的问题，还没有头绪，我先在开源内容里面找一下探索一下，老师有相关资源可以推荐吗**



#### 5. 协同路径规划算法验证分析

**5.1 仿真验证**

- 在仿真环境中测试算法性能，评估路径规划效率、成功率、收敛速度等指标。

**5.2 实车验证**

- 在实体沙盘上进行实车实验，验证算法在真实环境中的有效性。

- 记录实验数据，分析机器人之间的协同效果。

#### 6. 总结与展望

**6.1 研究成果总结**

- 总结本研究的主要成果和创新点。

**6.2 研究限制与未来工作**

- 讨论研究中的不足之处，如算法的局限性、实验条件的限制等。

- 展望未来可以改进和深入的方向。





### 关于技术确定和研究方法的建议

您提到目前对使用强化学习进行多机器人路径规划还没有头绪，以下是我的一些建议：

1. **文献调研**：加大对多智能体强化学习在路径规划领域的文献阅读，了解最新的研究动态和方法。
2. **聚焦问题**：明确研究问题，确定是要解决路径规划中的哪个具体问题，例如避障、协同、通信延迟等。
3. **算法实现**：从简单的环境和模型入手，尝试实现基本的强化学习算法，然后逐步增加复杂度。
5. **资源利用**：利用开源代码和工具，加快研究进程。

困惑是因为技术路线尚未完全确定，导致思路发散。

- **制定详细的计划**：将大目标分解为小任务，逐一攻克。

- **专注核心问题**：先解决关键技术问题，再扩展到其他方面。

- **多与他人交流**：同学、导师都是很好的交流对象，可以提供新的思路和建议。







### 物流设计大赛

关于物流设计大赛的事宜，和您沟通几点目前的情况和建议：

1. **大赛启动时间**：根据我获取的信息，物流设计大赛明年才会正式开始，目前组委会尚未成立，选题也未确定。因此，现阶段我们实际上还无法进行具体的准备工作。我建议我们可以开始收集和询问大家对物流设计大赛的想法和意愿，特别是23级和24级的同学，因为他们将是明年参赛的主力军。22级的同学由于即将面临毕业，可能不会参与比赛。
2. **组织队伍**：我认为在组织参赛队伍时，我们应该进行面试筛选，以确保队伍的质量。目前参与的同学背景各异，通过面试可以确保我们的队伍更加专业和高效。
3. **赞助商和赛题**：物流设计大赛通常会有赞助商，例如一汽物流、顺丰、中外运等。组委会会发布赞助商公司目前存在的问题，作为赛题。这些问题覆盖了从顶层战略到整车物流、零部件物流和厂内物流等多个方面，包括算法、硬件、计划等都可以作为切入点。目前，我们还没有具体的赛题，所以不需要急于准备。
4. **避免直接参考过往材料**：我不建议让参赛同学直接查看以往的材料。我们当年参赛时，吴老师也没有一开始就给我们材料。提前给出材料可能会限制大家的想法、思路和方案内容的创新。
5. **选题建议**：在比赛选题时，我建议我们应该务实，选择那些企业可以直接应用的方案。这样的方案更有可能在比赛中获奖，并且能够为企业带来实际价值。

综上所述，目前我们可以先从组织和动员同学开始，为明年的比赛打下基础。



