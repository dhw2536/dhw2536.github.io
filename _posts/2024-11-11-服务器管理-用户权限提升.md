---
layout:     post
title:      服务器管理-用户权限提升
subtitle:   总结了如何在 Linux 系统中提升用户权限，便于今后管理服务器和其他系统操作。
date:       2024-11-11
author:     Space
header-img: img/the-first.png
catalog:   true
tags:
    - 服务器管理


---



# Linux 用户权限提升学习记录

## 背景

在 Linux 系统中，管理员（即 `root` 用户）拥有对系统的完全控制权限。为了便于管理，其他普通用户可以被授予某些特权，执行需要管理员权限的操作。这篇文档记录了如何提升其他用户的权限，并确保操作成功。



## 目标

我们将把一个普通用户（例如 `guojilong`）提升为具有管理员权限的用户，使其可以执行 `sudo` 命令，管理系统。

## 步骤

### 1. **确认目标用户是否存在**

首先，需要确认要提升权限的用户是否已经存在。可以使用以下命令查看系统中的所有用户：

```bash
cut -d: -f1 /etc/passwd
```

这个命令会输出系统中所有的用户名。如果目标用户（例如 `guojilong`）在输出中，则表示该用户已经存在。如果没有找到该用户，需要先创建该用户。

### 2. **将用户加入 `sudo` 组**

为了将用户提升为管理员，我们需要将目标用户加入 `sudo` 组。假设目标用户为 `guojilong`，可以使用以下命令：

```bash
sudo usermod -aG sudo guojilong
```

这条命令的作用是将 `guojilong` 用户添加到 `sudo` 组。加入 `sudo` 组后，用户将能够使用 `sudo` 执行管理员权限的命令。

### 3. **验证用户是否成功加入 `sudo` 组**

可以通过以下命令来检查用户是否成功加入 `sudo` 组：

```bash
groups guojilong
```

如果输出类似以下内容：

```yaml
guojilong : guojilong sudo aptuser
```

则表示 `guojilong` 用户已经是 `sudo` 组的成员，拥有了管理员权限。

### 4. **让目标用户验证 `sudo` 权限**

为了确保目标用户已经成功获得管理员权限，可以要求该用户尝试执行一个需要管理员权限的命令。例如：

```bash
sudo whoami
```

系统将提示用户输入其密码。如果权限提升成功，输出应为 `root`，表示该用户已经拥有管理员权限。

### 5. **其他验证方法**

除了上述方法，还可以通过以下方式确认用户是否加入了 `sudo` 组：

#### 通过 `id` 命令：

```bash
id guojilong
```

输出中应该包含 `sudo` 组，类似于：

```scss
uid=1001(guojilong) gid=1001(guojilong) groups=1001(guojilong),27(sudo)
```

#### 通过 `/etc/group` 文件：

你还可以查看 `/etc/group` 文件，直接查找 `sudo` 组的成员：

```bash
grep sudo /etc/group
```

输出中应该包含目标用户：

```ruby
sudo:x:27:tsinghua-adept,guojilong
```

### 6. **总结**

- 成功将用户 `guojilong` 添加到 `sudo` 组后，该用户将能够执行管理员权限的操作。
- 使用 `groups` 或 `id` 命令来确认用户是否已成功加入 `sudo` 组。
- 让目标用户通过 `sudo whoami` 命令验证其是否能够使用管理员权限。

## 常见问题

1. **没有输入密码就结束了，是否成功？**

   - 如果命令执行没有报错，并且没有要求输入密码，可能是因为当前会话已经在短时间内验证过密码，或者你的用户已经具有 `sudo` 权限。你可以通过其他验证方法确认权限是否生效。

2. **目标用户没有在 `/etc/passwd` 中找到？**

   - 如果目标用户不存在，你需要先创建该用户。可以使用以下命令创建用户：

     ```bash
     sudo adduser guojilong
     ```

3. **如何让权限生效？**

   - 修改完用户组后，用户需要重新登录，或者可以通过运行 `newgrp sudo` 命令使更改立即生效。

------

### 附录：常用命令

- **查看系统所有用户**：

  ```bash
  cut -d: -f1 /etc/passwd
  ```

- **将用户添加到 `sudo` 组**：

  ```bash
  sudo usermod -aG sudo username
  ```

- **检查用户的组信息**：

  ```bash
  groups username
  ```

- **查看用户的详细组信息**：

  ```bash
  id username
  ```

- **验证 `sudo` 权限**：

  ```bash
  sudo whoami
  ```



## 补充内容1：提升用户的权限，以便能够执行特定的命令

### 概述

本文档旨在指导你如何临时提升 `guojilong` 用户的权限，以便他能够执行特定的命令（例如 `chmod`）而无需输入密码。我们将详细介绍如何确认当前权限设置、临时使用管理员权限执行命令、修改 `sudoers` 文件以及如何恢复原权限。

### 1. 确认当前的权限设置

首先，我们需要确认 `guojilong` 用户的当前权限。如果 `guojilong` 执行 `chmod` 命令时提示权限不足，这可能是因为该用户在 `sudoers` 文件中没有权限执行某些命令。

### 2. 临时使用管理员权限执行命令

如果你只是想临时帮助 `guojilong` 执行一个命令，可以直接以管理员身份执行 `guojilong` 需要的命令，而无需修改 `guojilong` 的权限。

#### 2.1 使用 `sudo` 执行命令

你可以通过 `sudo` 以管理员身份执行命令。例如，`chmod` 命令可以这样执行：

```bash
sudo chmod 777 /home/guojilong/.bashrc
```

**解释：** `sudo` 命令让你临时获得超级用户（root）权限，你需要输入你自己的密码而不是 `guojilong` 的密码。

#### 2.2 验证是否执行成功

如果命令执行成功，你可以通过以下命令验证文件权限是否已正确修改：

```bash
ls -l /home/guojilong/.bashrc
```

这会显示该文件的权限信息。如果权限已成功修改，输出会类似：

```
-rwxrwxrwx 1 guojilong guojilong 1234 Nov 11 12:34 /home/guojilong/.bashrc
```

权限 `rwxrwxrwx` 表示所有用户都可以读取、写入和执行这个文件。

### 3. 修改 `sudoers` 文件，允许 `guojilong` 执行特定命令

如果你希望 `guojilong` 用户在不每次通过管理员来执行命令的情况下，临时提升他的权限，你可以修改 `sudoers` 文件，允许该用户执行特定命令。

#### 3.1 编辑 `sudoers` 文件

首先，以管理员身份编辑 `sudoers` 文件。你可以使用 `visudo` 命令来安全地编辑这个文件，避免直接编辑导致语法错误。

```bash
sudo visudo
```

这个命令会打开一个编辑器（通常是 `nano` 或 `vim`），让你修改 `sudoers` 文件。

#### 3.2 授权 `guojilong` 执行特定命令

在 `sudoers` 文件中，你可以为 `guojilong` 用户添加一行，让他能够执行某些特定的命令而无需输入密码。例如，允许 `guojilong` 执行 `chmod` 命令而不受限制，可以添加以下行：

```bash
guojilong ALL=(ALL) NOPASSWD: /bin/chmod
```

这条规则的含义是：

- `guojilong` 可以在任何主机上（`ALL`）执行命令。
- `(ALL)` 表示 `guojilong` 可以作为任何用户（通常是 root）执行命令。
- `NOPASSWD:` 表示执行该命令时无需输入密码。
- `/bin/chmod` 指定了允许执行的命令路径。

保存并退出 `visudo` 编辑器（如果你使用的是 `nano`，可以按 `Ctrl + X`，然后按 `Y`，最后按 `Enter`）。

#### 3.3 验证 `guojilong` 是否能够使用 `sudo`

现在 `guojilong` 应该能够在不输入密码的情况下使用 `sudo` 执行 `chmod` 命令。让 `guojilong` 执行以下命令测试：

```bash
sudo chmod 777 /home/guojilong/.bashrc
```

如果设置正确，`guojilong` 应该能够成功执行该命令，且不会要求输入密码。

### 4. 如何恢复原权限

如果你希望将 `guojilong` 的权限恢复到原来的状态，只需要删除 `sudoers` 文件中的相应配置。

回到 `sudoers` 文件，再次使用 `sudo visudo` 编辑文件，并删除之前添加的行：

```bash
guojilong ALL=(ALL) NOPASSWD: /bin/chmod
```

然后保存退出。

### 5. 总结

- 如果你仅仅想帮助 `guojilong` 执行命令，可以使用 `sudo` 来临时以管理员身份执行。
- 如果你希望 `guojilong` 有权限执行特定命令，可以修改 `sudoers` 文件，给该用户增加执行某些命令的权限。
- 修改 `sudoers` 文件时请小心操作，确保语法正确，避免错误导致权限问题。

以上就是临时提升 `guojilong` 权限的详细步骤。如果你不清楚某些步骤或命令，随时告诉我，我会提供更具体的指导。

---

### 相关概念解释

#### 什么是 `sudoers` 文件？

在 Linux 系统中，`sudoers` 文件用于配置哪些用户或用户组可以执行哪些命令，以及是否需要输入密码等。通过编辑 `sudoers` 文件，我们可以控制用户在执行特定命令时是否具有管理员权限。

#### 为什么使用 `visudo` 命令？

当你执行 `sudo visudo` 命令时，你是在以管理员权限编辑系统的 `sudoers` 文件，这个文件默认用于管理哪些用户有权限执行 `sudo` 命令。你不能直接编辑 `/etc/sudoers` 文件，因为如果语法错误，系统会变得不稳定或无法恢复，而 `visudo` 命令会在保存时自动检查语法错误，保证安全。

#### 什么是 `NOPASSWD`？

`NOPASSWD` 是 `sudoers` 文件中的一个选项，表示用户在执行指定的命令时不需要输入密码。这对于需要频繁执行某些命令的用户来说非常方便，但同时也增加了安全风险，因此需要谨慎使用。

####  了解 Linux 系统的用户和权限

Linux 是一种多用户操作系统，每个用户都有不同的权限。作为管理员，你通常需要通过 `sudo` 权限来执行一些管理任务（比如配置环境、安装软件等）。你提到的是需要帮助某个用户获得权限来配置环境，那么我们首先要确认的是该用户是否有管理员权限。

#### 理解你的环境

你是通过 **ToDesk** 远程进入服务器的桌面。ToDesk 是一款类似于远程桌面软件，它允许你在本地电脑上控制远程服务器的桌面。因此，第一步是你已经可以进入服务器的桌面环境了，但这只是第一步。

**为什么需要登录？**

在 Linux 系统中，"登录" 一般指的是进入操作系统并建立一个用户会话。当你通过远程桌面工具（如 ToDesk）进入服务器时，你已经进入了一个桌面环境。此时，系统可能已经为你创建了一个会话，也就是登录状态。

**在远程桌面环境下，你通常已经是“登录”的状态**

通过 ToDesk 进入服务器后，**你已经登录**到服务器的桌面环境中了，这和你通过终端（Terminal）登录到系统类似。因此，你不需要再进行额外的登录步骤，只需要确认你能否在该环境下执行管理任务。

**确认自己是否是管理员**

在 Linux 系统中，只有管理员（也叫 root 用户）或者有管理员权限的用户（通常属于 `sudo` 组的用户）才能进行一些管理操作。所以，第一步是确认你是否有管理员权限。如果你有权限，我们可以继续操作；如果没有权限，你需要联系有管理员权限的人来做这些步骤。

**通过 ToDesk 进入服务器，打开终端（Terminal）**

在服务器的桌面环境中，你应该能找到一个叫 "Terminal" 的程序，通常它是一个命令行界面。你可以点击打开它，它看起来就像一个黑色的窗口，你可以在里面输入命令。

**查看当前用户权限**

在命令行中输入下面的命令，查看当前用户属于哪些组：

```bash
groups
```
